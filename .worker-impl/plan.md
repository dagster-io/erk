# Plan: Document Hook Marker Detection Pattern

> **Replans:** #4829

## What Changed Since Original Plan

- PR #4830 (the documentation PR) was **closed due to merge conflicts** and never merged
- The implementation code (PR #4828) is fully merged and stable
- No code changes since original plan - only documentation is missing

## Investigation Findings

### Corrections to Original Plan
None - the original plan accurately described the pattern and code locations.

### Additional Details Discovered
- All detection functions exist and work as documented
- Tests are comprehensive (336 lines in `tests/unit/core/capabilities/test_hooks.py`)
- The `docs/learned/architecture/index.md` entry will be auto-generated by `erk docs sync`

## Remaining Gaps

| Item | Status |
|------|--------|
| `docs/learned/architecture/hook-marker-detection.md` | ❌ Not created |
| Cross-link in `capability-system.md` | ❌ Not added |
| Index entry | ❌ Will be auto-generated |

## Implementation Steps

### 1. Create `docs/learned/architecture/hook-marker-detection.md`

Create the documentation file with:
- Frontmatter with `category: architecture` and `read_when` triggers
- Overview of the marker pattern purpose
- Documentation of the three detection functions
- Three-tier detection strategy explanation
- Usage guidance

Use the draft content from the original plan (available in issue #4829's first comment).

### 2. Add cross-link in `capability-system.md`

Add to the "Related Topics" section at the end of `docs/learned/architecture/capability-system.md`:

```markdown
- [Hook Marker Detection](hook-marker-detection.md) - Version-aware detection for hooks
```

### 3. Run `erk docs sync`

This will:
- Validate frontmatter
- Auto-generate the index entry in `docs/learned/architecture/index.md`

## Critical Files

- `docs/learned/architecture/hook-marker-detection.md` (create)
- `docs/learned/architecture/capability-system.md` (edit - add cross-link)

## Verification

1. Run `erk docs validate` to check frontmatter is correct
2. Run `erk docs sync` to generate index entry
3. Verify cross-links work by checking the rendered markdown
4. Run CI to ensure no regressions