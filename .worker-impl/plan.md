# Audit Top 7 High-Priority docs/learned/ Documents

## Context

This is step 1.1 of objective #7132 ("Audit All docs/learned/ Documents"). The objective works through all documents by audit-scan score tier, starting with the highest-scoring docs.

The audit-scan scoring rubric (defined in `.claude/commands/local/audit-scan.md`) assigns points based on: missing audit metadata (+3), large line count (+1/+2), code blocks (+2), file path references (+2), broken paths (+3), imports (+1), step sequences (+1), behavioral claim density (+2), line number references (+1), with deductions for redirects (-2) and recently-edited status (-1).

These 7 documents are the current highest-priority candidates (score 11-12), excluding docs audited within the last 7 days.

## Documents to Audit

The following 7 documents, ordered by score, are the targets:

| # | Document | Score | Lines | Key Signals |
|---|----------|-------|-------|-------------|
| 1 | `architecture/tripwires.md` | 12 | 254 | No audit, 254 lines, 5+ file refs, broken path, high behavioral claims |
| 2 | `refactoring/libcst-systematic-imports.md` | 12 | 376 | 16 code blocks, 20 file refs, 3 broken paths, imports, step sequences |
| 3 | `architecture/live-display-gateway.md` | 11 | 121 | No audit, 12 file refs, broken path, step sequences |
| 4 | `capabilities/adding-skills.md` | 11 | 158 | 3 code blocks, 16 file refs, 2 broken paths, imports |
| 5 | `hooks/hooks.md` | 11 | 555 | 18 code blocks, 7 file refs, 2 broken paths, imports, edited status |
| 6 | `integrations/codex/codex-cli-reference.md` | 11 | 220 | 15 file refs, 2 broken paths, high behavioral claims |
| 7 | `planning/submit-branch-reuse.md` | 11 | 106 | No audit, 3 code blocks, broken path, step sequences |

## Changes

### For Each Document: Apply `/local:audit-doc` Methodology

For each of the 7 documents, perform the full audit process defined in `.claude/commands/local/audit-doc.md`:

**Prerequisites:**
- Load the `learned-docs` skill FIRST (read `.claude/skills/learned-docs/learned-docs-core.md`)
- Read `docs/learned/documentation/audit-methodology.md` for classification guidance

**Per-document process:**

1. **Read the document** fully and extract frontmatter
2. **Extract code references** — identify all `src/`, `packages/`, `tests/`, `.claude/` paths and symbols
3. **Read referenced source code** — verify functions/classes exist, capture collateral findings
4. **Verify system descriptions** — confirm workflows, behaviors, imports, symbols, types match reality
5. **Adversarial analysis** — classify each section as DUPLICATIVE, INACCURATE, DRIFT RISK, HIGH VALUE, CONTEXTUAL, REFERENCE CACHE, or EXAMPLES
6. **Code block triage** — classify each code block as ANTI-PATTERN, CONCEPTUAL, VERBATIM, REFERENCE TABLE, or TEMPLATE
7. **Generate verdict** — produce brief summary with percentages and planned changes
8. **Apply changes** — use `--auto-apply` behavior since this is CI: KEEP→stamp clean, NEEDS_UPDATE→fix+stamp, SIMPLIFY→rewrite+stamp, CONSIDER DELETING→stamp only
9. **Apply collateral fixes** — fix mechanical issues (stale comments, broken links) in other files; recommend separate audits for conceptual issues

### Document-Specific Pre-Audit Notes

These notes capture known issues discovered during planning to help the implementer focus:

#### 1. `architecture/tripwires.md` (Score 12)
- **IMPORTANT**: This is an AUTO-GENERATED file (line 7: `<!-- AUTO-GENERATED FILE - DO NOT EDIT DIRECTLY -->`). It has YAML frontmatter prepended, so it escapes the audit-scan's auto-generated filter.
- **Likely verdict: STAMP ONLY**. Since the content is generated by `erk docs sync`, the correct action is to add `last_audited` and `audit_result` to the frontmatter and verify the generation is working correctly. Do NOT rewrite content — regeneration would overwrite changes.
- Check that the frontmatter `read_when` conditions are appropriate
- Verify the tripwire entries reference docs that still exist

#### 2. `refactoring/libcst-systematic-imports.md` (Score 12)
- **Already audited** 2026-02-08 as `clean`, so this is a re-audit due to broken path detection
- **Known broken path**: `packages/erk-shared/src/erk_shared/gateway/command_executor.py` — this module doesn't exist. The doc uses it as an example path (`packages/foo/bar.py` style); verify if these are meant to be real or illustrative
- Has 16 code blocks — apply Code Block Triage carefully; many may be CONCEPTUAL/TEMPLATE examples for LibCST usage
- Cross-references to `.claude/agents/libcst-refactor.md` and `docs/learned/planning/gateway-consolidation-checklist.md` both exist

#### 3. `architecture/live-display-gateway.md` (Score 11)
- **Never audited** — no `last_audited` or `audit_result` in frontmatter
- Key source files to verify against:
  - `packages/erk-shared/src/erk_shared/gateway/live_display/real.py` (EXISTS)
  - `packages/erk-shared/src/erk_shared/gateway/live_display/fake.py` (EXISTS)
  - `src/erk/cli/commands/plan/list_cmd.py` (EXISTS)
- Likely high-value: gateway pattern documentation with test capture patterns

#### 4. `capabilities/adding-skills.md` (Score 11)
- **Already audited** 2026-02-08 as `clean`
- **Known broken path**: `src/erk/capabilities/skills/dignified_python.py` does NOT exist
  - Actual locations: `src/erk/capabilities/reviews/dignified_python.py` and `src/erk/capabilities/reminders/dignified_python.py`
  - This was a known issue from the Feb 15 audit of `capabilities/folder-structure.md` (same broken reference was found there)
- Key source: `src/erk/core/capabilities/skill_capability.py` (EXISTS), `src/erk/core/capabilities/registry.py` (EXISTS)
- Fix the broken DignifiedPython path reference to use BundledSkillCapability or correct current path

#### 5. `hooks/hooks.md` (Score 11)
- **Last audited** 2026-02-03, result: `edited` — oldest audit in this batch
- **Known broken path**: `src/erk/exec/pre_tool_use_hook.py` does NOT exist
  - Actual path: `src/erk/cli/commands/exec/scripts/pre_tool_use_hook.py`
- Large document (555 lines, 18 code blocks) — expect significant Code Block Triage work
- Two-part structure: Part 1 is general Claude Code hooks, Part 2 is erk-specific
- Part 1 content about Claude Code hooks is REFERENCE CACHE (third-party knowledge) — don't penalize as duplicative
- `.claude/settings.json` reference EXISTS

#### 6. `integrations/codex/codex-cli-reference.md` (Score 11)
- **Already audited** 2026-02-08 as `clean`
- This is explicitly a REFERENCE CACHE document — distilled third-party reference for OpenAI Codex CLI
- Key source files all verified to exist:
  - `packages/erk-shared/src/erk_shared/context/types.py`
  - `packages/erk-shared/src/erk_shared/gateway/agent_launcher/real.py`
  - `src/erk/core/capabilities/codex_portable.py`
- **High behavioral claim density** — many "does", "will", "must" statements about Codex behavior
- Verify Codex-related claims still match current erk integration code

#### 7. `planning/submit-branch-reuse.md` (Score 11)
- **Never audited** — no `last_audited` or `audit_result` in frontmatter
- Key source: `src/erk/cli/commands/submit.py` (EXISTS)
- Cross-references to `docs/learned/planning/lifecycle.md` (EXISTS) and `docs/learned/erk/graphite-branch-setup.md` (EXISTS)
- Relatively small (106 lines) — should be quick to audit
- Focus on verifying the branch detection logic and Graphite integration patterns still match `submit.py`

### Frontmatter Updates

For every document audited, update (or add) these frontmatter fields:

```yaml
last_audited: "YYYY-MM-DD HH:MM PT"  # Current time in 24h Pacific format
audit_result: clean | edited          # clean if no changes; edited if rewritten
```

### Post-Audit: Run `erk docs sync`

After all 7 documents have been audited and any edits applied, run `erk docs sync` to regenerate auto-generated index and tripwire files. This ensures any cross-reference fixes propagate correctly.

## Implementation Details

### Execution Strategy

Run audits sequentially (not in parallel) because:
- Each audit reads source files that may overlap with other audits
- Collateral fixes from one audit may affect files referenced by another
- Sequential execution ensures consistent state

### Skill Loading

Load `learned-docs` skill once at the start. It persists for the session and provides the content quality standards used throughout.

### Code Patterns to Follow

- **LBYL**: Check paths exist before claiming they're broken
- **Source pointers**: When replacing VERBATIM code blocks, use the format from `.claude/skills/learned-docs/learned-docs-core.md`
- **One Code Rule exceptions**: ANTI-PATTERN, CONCEPTUAL, INPUT/OUTPUT EXAMPLES, and REFERENCE TABLES are legitimate keeps
- **Constants exception**: Constants and defaults mentioned in prose are HIGH VALUE, not duplicative

### Audit Result Format

For each document, output the standard verdict line:
```
Audit: <doc-path> | Verdict: <VERDICT> | Duplicative: X% | Inaccurate: X% | High-value: Y%
Verification: X verified | Y broken/stale
```

### Commit Message Format

After all audits are complete, commit with a message like:
```
Audit 7 highest-priority docs/learned/ documents (score 11-12)
```

The commit should list which documents were audited and their verdicts in the body.

## Files NOT Changing

- **Source code files** — only documentation in `docs/learned/` is being modified, unless collateral findings require fixing stale comments in source files already referenced by the audited docs
- **Auto-generated files** — `index.md`, other `tripwires.md` files (except `architecture/tripwires.md` which gets a frontmatter stamp). `erk docs sync` handles regeneration
- **CHANGELOG.md** — never modified directly
- **Test files** — no test changes needed for documentation audits

## Verification

1. **All 7 docs have `last_audited` and `audit_result`** in frontmatter with today's date
2. **No broken file path references** remain in the 7 audited docs (broken paths either fixed or removed)
3. **`erk docs sync` succeeds** without errors after all edits
4. **CI passes**: Run `make check` to verify formatting and linting pass
5. **Verdict summary**: Each document has a recorded verdict (KEEP, SIMPLIFY, NEEDS_UPDATE, or CONSIDER DELETING) with percentage breakdowns