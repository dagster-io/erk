[project]
name = "csbot"
version = "0.1.0"
description = "Compass Bot"
authors = [
    {name = "Elementl", email = "info@elementl.com"}
]
requires-python = ">=3.13"
dependencies = [
    "csadmin",
    "click",
    "pygit2",
    "pyyaml",
    "snowflake-connector-python[secure-local-storage]",
    "pydantic",
    "anthropic",
    "fastapi==0.110.0",
    "uvicorn==0.27.1",
    "python-jose==3.3.0",
    "google-auth==2.28.1",
    "google-auth-oauthlib==1.2.0",
    "python-multipart==0.0.9",
    "python-dotenv==1.0.1",
    "redis[hiredis]>=6.2.0",
    "pyjwt>=2.10.1",
    "PyGithub>=2.1.1",
    "slack-sdk>=3.27.0",
    "aiohttp==3.13.2",
    "matplotlib>=3.8.0",
    "wordcloud>=1.9.0",
    "snowflake-sqlalchemy>=1.7.5",
    "sqlalchemy>=2.0.41",
    "tantivy>=0.25.0",
    "jinja2>=3.1.6",
    "aiohttp-jinja2>=1.6.0",
    "aiohttp-cors>=0.7.0",
    "sqlalchemy-bigquery>=1.15.0",
    "duckdb-engine>=0.17.0",
    "mcp>=1.12.1",
    "pydantic-ai-slim[anthropic]>=0.4.7",
    "croniter>=6.0.0",
    "ruff>=0.12.7",
    "google-cloud-bigquery-storage>=2.32.0",
    "structlog>=24.1.0",
    "requests>=2.32.0",
    "pyathena[sqlalchemy]>=3.17.1",
    "boto3>=1.40.1",
    "stripe>=11.0.0",
    "redshift-connector>=2.1.8",
    "markdown>=3.7.0",
    "ddtrace>=3.14.1",
    "analytics-python>=1.4.0",
    "datadog>=0.52.1",
    "aiomonitor>=0.7.1",
    "libhoney>=2.4.0",
    "databricks-sql-connector>=4.1.4",
    "databricks-sdk>=0.71.0",
    "psycopg[binary,pool]>=3.2.12",
    "temporalio>=1.18.1",
    "rich>=14.2.0",
    "aws-advanced-python-wrapper>=1.4.0",
]

[project.scripts]
ctx-admin = "csbot.ctx_admin.cli.main:cli"
slackbot = "csbot.cli.slackbot_cli:cli"
compass-dev = "csbot.compass_dev.cli:cli"
compass-temporal-worker = "csbot.temporal.worker_cli:cli"

[dependency-groups]
dev = [
    "pytest>=8.4.1",
    "pytest-asyncio>=0.23.0",
    "testcontainers>=4.9.0",
    "pyright>=1.1.389",
    "fakeredis>=2.25.0",
    "pytest-xdist>=3.8.0",
    "playwright>=1.40.0",
    "pytest-playwright>=0.4.0",
    "hypothesis>=6.142.4",
    "filelock>=3.16.0",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.build.targets.wheel]
packages = ["src/csbot"]

[tool.pytest.ini_options]
filterwarnings = [
    "ignore::RuntimeWarning:_pytest.unraisableexception",
    "ignore:coroutine 'AsyncMockMixin._execute_mock_call' was never awaited:RuntimeWarning",
    # Suppress testcontainers deprecation warnings (third-party library)
    "ignore:The @wait_container_is_ready decorator is deprecated:DeprecationWarning:testcontainers",
    # Suppress aiomonitor click deprecation warnings (third-party library)
    "ignore:Importing 'parser.split_arg_string' is deprecated:DeprecationWarning:aiomonitor",
    # Suppress temporalio pydantic v1 deprecation warnings (third-party library)
    "ignore:If you're using Pydantic v2:UserWarning:temporalio",
    "ignore:The `dict` method is deprecated:pydantic.warnings.PydanticDeprecatedSince20:temporalio",
    "ignore:The `parse_obj` method is deprecated:pydantic.warnings.PydanticDeprecatedSince20:temporalio"
]

[tool.ruff]
# Target Python 3.13+
target-version = "py313"
line-length = 100

[tool.ruff.lint]
# Enable rules that enforce modern Python idioms
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # pyflakes
    "I",      # isort
    "UP",     # pyupgrade (enforces modern Python syntax)
    "FA",     # flake8-future-annotations
    "TCH",    # flake8-type-checking
]

# Force specific modern typing patterns
ignore = [
    # Disable E501 (line too long) - temporarily disabled to focus on other issues
    "E501",
    # Disable W291 (trailing whitespace) - temporarily disabled to focus on other issues
    "W291",
    # Disable W293 (blank line contains whitespace) - temporarily disabled to focus on other issues
    "W293",
]

# Enable specific pyupgrade rules for modern typing
fixable = ["ALL"]
unfixable = []

[tool.ruff.lint.pyupgrade]
# Force PEP 585 (built-in generics like list[str] instead of List[str])
# Force PEP 604 (X | Y instead of Union[X, Y])
keep-runtime-typing = false

[tool.ruff.lint.flake8-type-checking]
# Enforce that type-only imports are in TYPE_CHECKING blocks
runtime-evaluated-base-classes = ["pydantic.BaseModel"]
strict = true

[tool.ruff.format]
# Use double quotes
quote-style = "double"

# Keep trailing commas for better git diffs
skip-magic-trailing-comma = false
